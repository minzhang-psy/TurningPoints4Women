---
title: "Turning Points Codebook"
# author: 
#   - name: "Maria L. Schweer-Collins, PhD"
#     email: "mschweer@uoregon.edu"
#     affiliations:
#       - name: 'University of Oregon'
#         city: 'Eugene'
#         state: 'OR'
#   - name: "Shaina Trevino, PhD"
#     email: "strevino@uoregon.edu"
#   - name: "Jonathan A. Pedroza, PhD"
#     email: "cpppedroza@gmail.com"
#   - name: "Min Zhang"
#     email: "mzhang8@uoregon.edu"
date: "2023-07-31"
output: 
  html_document:
    toc: true
    toc_depth: 4
    toc_float: true
    #html#toc_title: Contents
    #number_sections: true
    #html#number_depth: 3
    #qmd#colorlinks: true
    #keep_tex: yes
    #pdf#latex_engine: pdflatex
    #error#includes: 
      #error#in_header: styles.css
#pdf#geometry: landscape
bibliography: tpw_references.bib
editor_options: 
  markdown: 
    wrap: 72
---

TODO: double check codebook_fun.r composite_total_avg_fun

```{r setup, include = FALSE}
library(tidyverse)
library(here)
library(gt)
library(ggplot2)
library(scales)
library(ggpubr)

knitr::opts_chunk$set(warning = FALSE,
                      message = FALSE,
                      echo = FALSE)

theme_set(theme_light())

#import included survey items
# data <- read_csv(here("do_not_push", "tpw_data_77included.csv"))

#import df of calculated survey items
#complete_rnd2 <- read_csv(here("do_not_push", "round_two_measures_data_calc.csv"))

#import telephone survey data 
complete <- read_csv(here("do_not_push","tpw_archive_calc.csv"))

#import raw qualtrics data for parsing question text
qualtrics <- read_csv(here("do_not_push", "tpw_raw_qualtrics_5-30-23.csv"))

source(here("functions", "codebook_fun.R"))
```

```{r plot-style, echo=FALSE}
# Color palettes 
 Two_color = c("#246B69", "#604C41")

# Histogram style 
# hist_style <- geom_histogram(bins=20, color = "white", fill = "#246B69", alpha = 0.7)


bar_style <- geom_bar(color = "white", fill = "#246B69", alpha = 0.7)

THEME <-     theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(fill = "transparent"),
          panel.border = element_blank(),
          axis.line = element_line(colour = "black",size = .8),
          axis.text = element_text(size = 10), axis.title = element_text(size = 10),
          legend.text = element_text(size = 10),legend.key = element_rect(fill = "White", colour = "transparent"),plot.title = element_text(size= 13),
    )
```

```{r cutoff-plot-function}
#re-work JP cutoff function due to error "cant use `{{` in non-quoting function
cutoff_plot2 <- function(data,
                        x,
                        cutoff = 0,
                        cutoff_color = '#324B4A',
                        cutoff_other = NULL,
                        cutoff_other_color = '#95B1AF',
                        cutoff_other2 = NULL,
                        cutoff_other2_color = '#546085',
                        bins = 20) {

  library(magrittr)
  library(dplyr)
  library(ggplot2)

  x <- enquo(x)

  if (is.null(cutoff_other)) {
    data %>%
      ggplot(aes(!!x)) +
      geom_histogram(bins = bins,
                     color = 'white',
                     fill = '#246B69',
                     alpha = .7) +
      geom_vline(xintercept = cutoff,
                 color = cutoff_color,
                 linetype = 2,
                 linewidth = 1.25)+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(fill = "transparent"),
          panel.border = element_blank(),
          axis.line = element_line(colour = "black",size = .8),
          axis.text = element_text(size = 10), axis.title = element_text(size = 10),
          legend.text = element_text(size = 10),
          legend.key = element_rect(fill = "White",
                                    colour = "transparent"),
          plot.title = element_text(size= 20),
          #scale_x_discrete(guide = guide_axis(n.dodge=3))
    )
  } else if (is.null(cutoff_other2)) {
    data %>%
      ggplot(aes(!!x)) +
      geom_histogram(bins = bins,
                     color = 'white',
                     fill = '#246B69',
                     alpha = .7) +
      geom_vline(xintercept = cutoff,
                 color = cutoff_color,
                 linetype = 2,
                 linewidth = 1.25) +
      geom_vline(xintercept = cutoff_other,
                 color = cutoff_other_color,
                 linetype = 3,
                 linewidth = 1.25)+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(fill = "transparent"),
          panel.border = element_blank(),
          axis.line = element_line(colour = "black",size = .8),
          axis.text = element_text(size = 10), axis.title = element_text(size = 10),
          legend.text = element_text(size = 10),
          legend.key = element_rect(fill = "White",
                                    colour = "transparent"),
          plot.title = element_text(size= 13),
          #scale_x_discrete(guide = guide_axis(n.dodge=3))
    )
  } else {
    data %>%
      ggplot(aes(!!x)) +
      geom_histogram(bins = bins,
                     color = 'white',
                     fill = 'black',
                     alpha = .7) +
      geom_vline(xintercept = cutoff,
                 color = cutoff_color,
                 linetype = 2,
                 linewidth = 1.25) +
      geom_vline(xintercept = cutoff_other,
                 color = cutoff_other_color,
                 linetype = 3,
                 linewidth = 1.25) +
      geom_vline(xintercept = cutoff_other2,
                 color = cutoff_other2_color,
                 linetype = 4,
                 linewidth = 1.25)+
    theme(panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.background = element_rect(fill = "transparent"),
          panel.border = element_blank(),
          axis.line = element_line(colour = "black",size = .8),
          axis.text = element_text(size = 10), axis.title = element_text(size = 10),
          legend.text = element_text(size = 10),
          legend.key = element_rect(fill = "White",
                                    colour = "transparent"),
          plot.title = element_text(size= 13),
          #scale_x_discrete(guide = guide_axis(n.dodge=3))
    )
  }
}

# gt-theme-general
apply_tbl_theme <- function(table) {
  table %>% 
  tab_style(style = list(cell_borders(sides = "all", color = "black", weight = px(1))),
            locations = cells_body(columns = everything())) %>% 
  tab_style(style = list(cell_borders(sides = "all", color = "black", weight = px(1)),
                         cell_fill(color = "#246B69", alpha = .7)),
            locations = cells_column_labels()) %>% 
  tab_options(column_labels.border.top.color = "black",
              column_labels.border.bottom.color = "black",
              table_body.border.bottom.color = "black",
              table.border.top.color = "white",
              heading.border.bottom.color = "black",
              table_body.hlines.color = "white")%>% 
  tab_options(table.align = "left")
}

#theme for value label tables
apply_labtab_theme <- function(table) {
  table %>% 
  cols_align(columns = everything(), align = "center") %>% 
  tab_style(style = list(cell_borders(sides = "all", color = "black", weight = px(1))),
            locations = cells_body(columns = everything())) %>% 
  tab_style(style = list(cell_borders(sides = "all", color = "black", weight = px(1)),
                         cell_fill(color = "#246B69", alpha = .7)),
            locations = cells_column_labels()) %>% 
  tab_options(column_labels.border.top.color = "black",
              column_labels.border.bottom.color = "black",
              table_body.border.bottom.color = "black",
              table.border.top.color = "white",
              heading.border.bottom.color = "black",
              table_body.hlines.color = "white") %>% 
  tab_options(table.align = "left")
}
  
```

# Overview

<MARIA>INSERT BRIEF INFO ON STUDY, SAMPLE, AND AIMS

*Additional info to possibly include: global missing data info, links to
supplemental materials, any disclaimers/info we think data users need to
know to use these data accurately*

<SHAINA>INSERT BRIEF DESCRIPTION OF DATA/CODEBOOK LAYOUT/FILE STRUCTURE
(can complete once we have more sections and overall structure)

### Missing Data

-   Truly missing = `NA` (blank in file or -99) = The question should
    have been asked of the respondent, but for a reason other than those
    listed below, no answer was given or recorded.

    This -99 is also given in the case of a computed subscale or total
    score or other summary when the percentage of missing data is
    outside what is allowable for missing data rules

-   Not Applicable = -55 = The subject was never asked a question for
    some reason (conditional question)

-   Don't Know = -66 = The subject was unable to answer a question,
    either because he or she had no opinion or because the required
    information was not available (could not recall).

-   Refusal/No Answer = -77 = The subject explicitly refused to answer a
    question or did not answer it when he or she should have.

-   No Match = -88 = This situation arises when data are drawn from
    different sources (for example, a survey questionnaire and an
    administrative database), and information from one source cannot be
    located.

-   Processing Error = -44 = For some reason, there is no answer to the
    question, although the subject provided one. This can result from
    interviewer error, incorrect coding, machine failure, or other
    problems

### Missing Data Rule

For summary or subscale scores that are computed with individual items,
any of the above reasons are included in computing the percent of
missing data

-   For scales with [10 or more items]{.underline}, a composite score
    (average/total) is computed for each participant that have less than
    [20%]{.underline} of the items from that measure missing

-   For scales with [7 to 9 items]{.underline}, a composite score
    (average/total) is computed for each participant that have less than
    [30%]{.underline} of the items from that measure missing

-   For scales with [3 to 6 items]{.underline}, a composite score
    (average/total) is computed for each participant that have less than
    [33%]{.underline} of the items from that measure missing

-   For scales with [only 2 items]{.underline}, composite scores
    (average/total) are calculated on a [case by case basis]{.underline}

<MARIA>INSERT REFERENCE LINK (from JP?)

# Mental Health Measures

<MARIA>INSERT BRIEF DESCRIPTION ABOUT CONSTRUCT DOMAIN (why distinct
from others)

## Brief Symptom Inventory (BSI)

### BSI Description

The BSI is a brief self-report scale used to assess psychological
symptoms in adolescents and adults.

For the present study, 19 items from the BSI were collected in order to
calculate the Somatization, Anxiety, and Depression subscales.

Item numbers in this data set may not match original item numbers from
the BSI exactly <MARIA> is this correct - what other info do we need to
include about mismatch between ours and original measure?

No items need to be reverse scored. Higher scores indicate more severe
mental health symptoms.

The missing data rule was not applied since there are no missing data
among BSI variables.

Reference:
[\@derogatis1983brief](https://www.cambridge.org/core/journals/psychological-medicine/article/abs/brief-symptom-inventory-an-introductory-report/307F805810B165ED58581E355F24329F);
[DOI](https://doi.org/10.1017/S0033291700048017)

### BSI Variables

#### Value Labels

All BSI variables have the same response options.

```{r BSI-label-table, results = 'asis'}

bsi_label_df <- data.frame(
  value = c("1", "2", "3", "4", "5"),
  label = c("Not at all",
            "A little bit",
            "Moderately",
            "Quite a bit",
            "Very much")
) %>% 
  t() %>% 
  as.data.frame()

bsi_label_df <- setNames(bsi_label_df[-1, ], unlist(bsi_label_df[1, ]))


#create table
bsi_label_table <- bsi_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme()

# Print the table
print(bsi_label_table)


```

#### Survey Items

BSI survey items are presented in the following table:

During the past week, how much were you bothered by...

```{r BSI-var-prep}
# Pull question wording from qualtrics data
bsi_word <- qualtrics %>% 
  select(starts_with("BSI")) %>% 
  slice(1)

#create table with variable name, description, and notes
bsi_word_long <- bsi_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         description = str_replace(description, "During the past week,", ""),
         description = str_replace(description, regex("how much were you bothered by", ignore_case = TRUE), ""),
         var_name = str_to_lower(var_name), 
          notes = case_when(var_name == "bsi4" ~ "This item was not asked for TC who were incarcerated while assessment were conducted",
                           TRUE ~ as.character(""))) %>% 
  slice(1:19)

```

```{r BSI-var-table, results ='asis'}
# Create the gt table object and apply generic theme
my_gt_table <- gt(bsi_word_long)

# Table-specific formatting (col width, names)
my_gt_table <- my_gt_table %>% 
  cols_label(var_name = "Variable", 
            description = "Description",
            notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(description ~ px(300),
             var_name ~ px(100)
             ) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(my_gt_table)

#WHEN RENDERING WITH PDF USE: 
#my_gt_table
```

#### Scale and Subscales

Information on the total score and subscale variables are below.
Variables were constructed by summing included items.

```{r bsi alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#Calculate internal reliability 
bsi_alpha <-
  complete %>%
  select(bsi1:bsi19) %>%
  psych::alpha(check.keys = TRUE)

bsi_alpha_som <-
  complete %>%
  select(bsi2:bsi3,
         bsi10:bsi13,
         bsi15) %>%
  psych::alpha(check.keys = TRUE)

bsi_alpha_anx <-
  complete %>%
  select(bsi1, bsi5, bsi9, bsi16:bsi18) %>%
  psych::alpha(check.keys = TRUE)

bsi_alpha_dep <-
  complete %>%
  select(bsi4, bsi6:bsi8, bsi14, bsi19) %>%
  psych::alpha(check.keys = TRUE)

```

```{r BSI-scale-table, results = 'asis'}
# TODO: Maria/Shania Please double check the score range since we changed the scale starting from 1 instead of 0. I wasn't sure if the range for total score should start from 0.  
# Create the table as a data frame
bsi_scale_df <- data.frame(
  var_name = c("bsi_total", "bsi_soma", "bsi_anx", "bsi_dep"),
  scale = c("Total Score (19)", "Somatization (7)", "Anxiety (6)", "Depression (6)"),
  scale_construction = c("`bsi1`, `bsi2`, `bsi3`, `bsi4`, `bsi5`, `bsi6`, `bsi7`, `bsi8`, `bsi9`, `bsi10`, `bsi11`, `bsi12`, `bsi13`, `bsi14`, `bsi15`, `bsi16`, `bsi17`, `bsi18`, `bsi19`",
                           "`bsi2`, `bsi3`, `bsi10`, `bsi11`, `bsi12`, `bsi13`, `bsi15`",
                           "`bsi1`, `bsi5`, `bsi9`, `bsi16`, `bsi17`, `bsi18`",
                           "`bsi4`, `bsi6`, `bsi7`, `bsi8`, `bsi14`, `bsi19`"),
  scale_range = c("0-95", "0-35", "0-30", "0-30"),
  alpha = c(round(bsi_alpha$total$raw_alpha, 3), 
            round(bsi_alpha_som$total$raw_alpha, 3), 
            round(bsi_alpha_anx$total$raw_alpha, 3), 
            round(bsi_alpha_dep$total$raw_alpha, 3))
)

# Create the gt table object
bsi_scale_table <- gt(bsi_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Scale (# of items)", 
            scale_construction = "Scale Construction",
            scale_range = "Range*",
            alpha = "Alpha") %>% 
  tab_footnote(footnote = "*Range of possible values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  #cols_width(scale_construction ~ pct(100)) %>% 
  apply_tbl_theme() 

# Print the table
print(bsi_scale_table)

```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item, total, and
subscale score:

```{r bsi-mean-items}
# Create subset of BSI items
data_subset <- complete %>%
  select(bsi1:bsi19, bsi_total, bsi_soma, bsi_anx, bsi_dep)

# Calculate the summary statistics for each variable
summary_data <- lapply(data_subset, function(x) {
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
summary_data <- as.data.frame(summary_data)

# Set items as first row
summary_data <- rbind(names(summary_data), summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
tbl <- summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
tbl

```

#### Distributions

Distributions are presented below for the total score and each subscale:

```{r bsi-distributions, class.source='fold', echo = FALSE}
p_bsi_total <- complete %>%
  composite_hist(x = bsi_total) 


p_bsi_soma <- complete %>%
  composite_hist(x = bsi_soma) 

p_bsi_anx <- complete %>%
  composite_hist(x = bsi_anx) 

p_bsi_dep <- complete %>%
  composite_hist(x = bsi_dep) 

ggarrange(p_bsi_total, p_bsi_soma + rremove("ylab"), 
          p_bsi_anx, p_bsi_dep + rremove("ylab")) %>%
  annotate_figure(top = text_grob( "Distribution for BSI Subscals \n(x-axis and y-axis are in different scales)"))
```

#### Clinical cutoff

TODO: Maria/Shaina, please confirm weather we need this section or not.

```{r bsi-clinical}
complete %>%
  cutoff_plot2(
    x = bsi_total,
    cutoff = 0
  ) +
  labs(title = 'Cutoff Value for BSI Measure')
```


## Center for Epidemiologic Studies Depression Scale (CES-D)

### CES-D Description

The CES-D is self-report scale used to assess major dimensions of
depression.

All 20 items from the CES-D were collected and two subscales were
calculated: positive affect and depressive symptoms. Four items (`c4`,
`c8`, `c12`, and `c16`) should be reverse scored which is noted in the
variable table below and the reverse scored variables are provided
(`c4_r`, `c8_r`, `c12_r`, and `c16_r`). Higher scores indicate the
presence of more symptoms.

Four additional variables (`c21`-`c24`) were included in this section to
assess suicidality. Variables `c22` and `c23` are only applicable if
participants responded "Yes" to `c21`.

The missing data rule was not applied since all participants had less
than 20% missing data. Missing data for each variable is presented in
the descriptive statistics table below.

Reference:
[\@radloff1977ces](https://journals.sagepub.com/doi/abs/10.1177/014662167700100306);
[DOI](https://doi.org/10.1177%2F014662167700100306)

-   Additional References:

    -   Cutoff Information:
        [\@henry2018determining](https://www.sciencedirect.com/science/article/pii/S0165032717319274?casa_token=Aan1lg2Z8mUAAAAA:aun9j7DwQRQLhRqhbBJQfpPQG4fDv4yjN1WGHvzv-Hh9Pu58f7IhyGyPTDJmeAUZWonwmO7tfi4);
        [DOI](https://doi.org/10.1016/j.jad.2018.02.071)

    -   Items for Potential Subscales:
        [\@canady2009measurement](https://connect.springerpub.com/content/sgrjnm/17/2/91.abstract);
        [DOI](10.1891/1061-3749.17.2.91)

### CES-D Variables

#### Value Labels

All CES-D survey items (`c1`-`c20`) have the same response options.

```{r CESD-label-table, results = 'asis'}

cesd_label_df <- data.frame(
  value = c("1", "2", "3", "4"),
  label = c("Rarely or none of the time",
            "Some or a little of the time",
            "Occasionally or a moderate amount of time",
            "Most or all of the time")
) %>% 
  t() %>% 
  as.data.frame()

cesd_label_df <- setNames(cesd_label_df[-1, ], unlist(cesd_label_df[1, ]))


#create table
cesd_label_table <- cesd_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme()

# Print the table
print(cesd_label_table)


```

Additional variables on suicidality (`c21`-`c24`) share the same
response options.

```{r CESD-label-table2, results = 'asis'}

cesd2_label_df <- data.frame(
  value = c("0", "1"),
  label = c("No",
            "Yes")
) %>% 
  t() %>% 
  as.data.frame()

cesd2_label_df <- setNames(cesd2_label_df[-1, ], unlist(cesd2_label_df[1, ]))


#create table
cesd2_label_table <- cesd2_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme() 

# Print the table
print(cesd2_label_table)


```

#### Survey Items

All CES-D survey items are presented in the following table:

```{r CESD-var-prep}
# Pull question wording from qualtrics data
cesd_word <- qualtrics %>% 
  select(C1:C24) %>% 
  slice(1)

#create table with variable name, description, and notes
cesd_word_long <- cesd_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name), 
         #description = case_when(var_name == "c21" ~ "In the past 6 months, have you ever thought about killing yourself?"),
         notes = case_when(var_name == "c4" ~ "This item should be reverse scored. `c4_r` is reverse scored",
                           var_name == "c8" ~ "This item should be reverse scored. `c8_r` is reverse scored",
                           var_name == "c12" ~ "This item should be reverse scored. `c12_r` is reverse scored",
                           var_name == "c16" ~ "This item should be reverse scored. `c16_r` is reverse scored",
                           
                           var_name %in% c("c22", "c23") ~ "Skipped if answered No for `c21`. \nThis item was not asked for TC who were incarcerated while assessment were conducted",
                           var_name %in% c("c21","c24") ~ "This item was not asked for TC who were incarcerated while assessment were conducted",
                           TRUE ~ as.character(""))) %>%
  mutate(description = if_else(var_name == "c21", "In the past 6 months, have you ever thought about killing yourself?", description))
  

```

```{r CESD-var-table, results ='asis'}
# Create the gt table object and apply generic theme
cesd_gt_table <- gt(cesd_word_long)

# Table-specific formatting (col width, names)
cesd_gt_table <- cesd_gt_table %>% 
  cols_label(var_name = "Variable", 
            description = "Description",
            notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(250),
             var_name ~ px(100)) %>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(cesd_gt_table)

```

#### Scale and Subscales

Information on the aggregated scale and subscale variables are below.
Total and subscale variables were constructed by summing corresponding
items.

```{r cesd-alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#Calculate internal reliability 
#TODO: After Maria confirm if the items are right this one, Min will need edits either this one or cleanning script. 
cesd_alpha <-
  complete %>%
  select(c1:c3,c4_r,c5:c7,c8_r,c9:c11, c12_r,c13:c15,c16_r,c17:c20) %>%
  psych::alpha(check.keys = TRUE)

cesd_dep_alpha <-
  complete %>%
  select(c1:c3,c5:c6, c9:c11,c13:c15,c17:c20) %>%
  psych::alpha(check.keys = TRUE)

cesd_pos_aff_alpha <-
  complete %>%
  select(c4_r, c8_r, c12_r, c16_r) %>%
  psych::alpha(check.keys = TRUE)


cesd_alpha_table <- tibble(
  Scale = c('CESD', 'CESD - Depressive Symptoms',
            'CESD - Positive Affect'),
  Alpha = c(round(cesd_alpha$total$raw_alpha, 3),
            round(cesd_dep_alpha$total$raw_alpha, 3),
            round(cesd_pos_aff_alpha$total$raw_alpha, 3)
  )
)
```

```{r CESD-scale-table, results = 'asis'}
# Create the table as a data frame
# TODO: should the calculation use revers score?
#TODO: Total range should be changed since we change the scale starting from 1
cesd_scale_df <- data.frame(
  var_name = c("cesd_total", "cesd_dep_symp_total", "cesd_pos_aff_total"),
  scale = c("Total Score (20)", "Depression (16)", "Positive Affect (4)"),
  scale_construction = c("`c1`, `c2`, `c3`, `c4_r`, `c5`, `c6`, `c7`, `c8_r`, `c9`, `c10`, `c11`, `c12_r`, `c13`, `c14`, `c15`, `c16_r`, `c17`, `c18`, `c19`, `c20`",
                           "`c1`, `c2`, `c3`, `c5`, `c6`, 
                         #`c7`, 
                         `c9`, `c10`, `c11`, `c13`, `c14`, `c15`, `c17`, `c18`, `c19`, `c20`",
                           "`c4_r`, `c8_r`, `c12_r`, `c16_r`"),
  scale_range = c("0-80", "0-64", "0-16"),
  alpha = c(round(cesd_alpha$total$raw_alpha, 3), round(cesd_dep_alpha$total$raw_alpha, 3), round(cesd_pos_aff_alpha$total$raw_alpha, 3))
)

# Create the gt table object
cesd_scale_table <- gt(cesd_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
            scale = "Scale (# of items)", 
            scale_construction = "Scale Construction",
            scale_range = "Range*",
            alpha = "Alpha") %>% 
  tab_footnote(footnote = "*Range of possible values; `_r` Reverse scored variable") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  cols_width(scale_construction ~ pct(100)) %>% 
  apply_tbl_theme()

# Print the table
print(cesd_scale_table)

```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item, total, and
subscale score:

```{r cesd-mean-items}
# Create subset of CESD items
data_subset_cesd <- complete %>%
  select(c1:c24, cesd_total, cesd_dep_symp, cesd_pos_aff)

# Calculate the summary statistics for each variable
summary_data_cesd <- lapply(data_subset_cesd, function(x) {
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- sprintf("%.2f", round(sd(x, na.rm = TRUE), 2))
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
summary_df_cesd <- as.data.frame(summary_data_cesd) %>% 
  rbind(names(summary_data_cesd)) %>% 
  t() %>% 
  as.data.frame() %>% 
  select(`5`, everything())

# Create the gt table
cesd_tbl <- summary_df_cesd %>%
  gt() %>%
  cols_label(`5` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(`5` ~ px(170)) %>%
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
cesd_tbl

```

#### Distributions

Distributions are presented below for the total score and each subscale:

```{r cesd-distributions, class.source='fold', echo = FALSE}
p_cesd_total <- complete %>%
  composite_hist(cesd_total) +
  labs(
    title = 'CESD Total Score Distribution'
    )

p_cesd_dep_symp <- complete %>%
  composite_hist(
    cesd_dep_symp
    ) +
  labs(
    title = 'Depressive Symptoms Subscale Distribution'
    )

p_cesd_pos_aff <- complete %>%
  composite_hist(
    cesd_pos_aff,
    bins = 10
    ) +
  labs(
    title = 'Positive Affect Subscale Distribution'
    )

ggarrange(p_cesd_total, p_cesd_dep_symp + rremove("ylab"), 
          p_cesd_pos_aff) %>%
  annotate_figure(top = text_grob( "Distribution for CESD Subscals \n(x-axis and y-axis are in different scales)"))

```

#### Clinical Categories

The distribution for CES-D scores alongside clinical cutoffs are
presented below.

<MARIA>INSERT MORE INFO ON 16/23 CUTOFF SCORES - what are they (what
should plot labels be)?, how should they be used

Reference:
[\@henry2018determining](https://www.sciencedirect.com/science/article/pii/S0165032717319274?casa_token=Aan1lg2Z8mUAAAAA:aun9j7DwQRQLhRqhbBJQfpPQG4fDv4yjN1WGHvzv-Hh9Pu58f7IhyGyPTDJmeAUZWonwmO7tfi4);
[DOI](https://doi.org/10.1016/j.jad.2018.02.071)

```{r cesd-clinical}
complete %>%
  cutoff_plot2(
    x = cesd_total,
    cutoff = 16,
    cutoff_other = 23
  ) +
  labs(
    title = 'Cutoff Scores for CESD Total Scores',
    caption = 'Cutoffs are 16 and/or 23\nSee references for literature on cutoff scores.', 
    y = "Number of Participants"
  ) +
  geom_text(aes(x = 16, y = 16.5, label = "cutoff1", vjust = -.25, hjust = 1.2)) + ###MARIA INSERT CUTOFF LABEL
  geom_text(aes(x = 16, y = 16.5, label = "cutoff2", vjust = -.25, hjust = -1.8))  ##MARIA INSERT CUTOFF LABEL
```



## Coronavirus Impacts Questionnaire (CIQ)

### CIQ Description

The CIQ is self-report survey used to assess the financial, resource,
and psychological impacts of COVID-19.

For the present study, 3 items from the CIQ were collected in order to
construct the psychological impacts scale.

`ciq1` need to be reverse scored. Higher scores indicate increased
psychological impacts of COVID-19.

The missing data rule was not applied since there is no missing data
among CIQ variables.

Reference: [\@conway2020social](https://psyarxiv.com/z2x9a/)

### CIQ Variables

#### Value Labels

All CIQ variables have the same response options.

```{r ciq-label-table, results = 'asis'}

ciq_label_df <- data.frame(
  value = seq(1:7),
  label = c("Not true of me at all",
            "2",
            "3",
            "4",
            "5",
            "6",
            "Very true of me")) %>% 
  t() %>% 
  as.data.frame()

ciq_label_df <- setNames(ciq_label_df[-1, ], unlist(ciq_label_df[1, ]))


#create table
ciq_label_table <- ciq_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ pct(100)) %>% 
  apply_labtab_theme()

# Print the table
print(ciq_label_table)


```

#### Survey Items

All CIQ survey items are presented in the following table:

```{r ciq-var-prep}
# Pull question wording from qualtrics data
# ciq is from BIS question 20-22
# TODO: Check range of possible values 
ciq_word <- qualtrics %>% 
  select(starts_with("BSI")) %>% 
  slice(1)

#create table with variable name, description, and notes
ciq_word_long <- ciq_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name),
         notes = case_when(var_name == "bsi22" ~ "This item should be reverse scored. `ciq3_r` is reverse scored",
                           TRUE ~ as.character("")
                           )) %>% 
  mutate(description = if_else(var_name == "bsi20", "I have become depressed because of the Coronavirus (COVID-19).", description)) %>%
  mutate(var_name = case_when(var_name == "bsi20" ~ "ciq1",
                              var_name == "bsi21" ~ "ciq2",
                              var_name == "bsi22" ~ "ciq3",
                              TRUE ~ var_name)) %>% 
  slice(20:22)

```

```{r ciq-var-table, results ='asis'}
# Create the gt table object and apply generic theme
ciq_gt_table <- gt(ciq_word_long)

# Table-specific formatting (col width, names)
ciq_gt_table <- ciq_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description",
             notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(150),
             var_name ~ px(100)) %>%
   tab_options(table.width = pct(100))%>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())

# Print the table
print(ciq_gt_table)

#WHEN RENDERING WITH PDF USE: 
#ciq_gt_table
```

#### Scale and Subscales

Information on the total score and subscale variables are below.
Variables were constructed by summing included items.

```{r ciq alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#Calculate internal reliability 
ciq_alpha <-
  complete %>%
  select(ciq1,ciq2,ciq3_r) %>%
  psych::alpha(check.keys = TRUE)

```

```{r ciq-scale-table, results = 'asis'}
# Create the table as a data frame
ciq_scale_df <- data.frame(
  var_name = c("ciq_psych_total"),
  scale = c("Total Score (3)"),
  scale_construction = c("`ciq1`, `ciq2`, `ciq3_r`"),
  scale_range = c("3-21"),
  alpha = c(round(ciq_alpha$total$raw_alpha, 3))
)

# Create the gt table object
ciq_scale_table <- gt(ciq_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
             scale = "Scale (# of items)", 
             scale_construction = "Scale Construction",
             scale_range = "Range*",
             alpha = "Alpha") %>% 
  tab_footnote(footnote = "*Range of possible values; `_r` Reverse scored variable") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  cols_width(var_name ~ pct(25),
             scale ~ pct(25),
             scale_construction ~ pct(25)
             ) %>% 
   tab_options(table.width = pct(100))%>%
  apply_tbl_theme() 

# Print the table
print(ciq_scale_table)

```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item and the total
score:

```{r ciq-mean-items}
# Create subset of BSI items
# TODO: Maria, I didn't remove _total for this one, let me know how you like it. 
ciq_data_subset <- complete %>%
  select(ciq1:ciq2, ciq3, ciq_psych_total)

# Calculate the summary statistics for each variable
ciq_summary_data <- lapply(ciq_data_subset, function(x) {
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
ciq_summary_data <- as.data.frame(ciq_summary_data)

# Set items as first row
ciq_summary_data <- rbind(names(ciq_summary_data), ciq_summary_data) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
ciq_tbl <- ciq_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range*",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ pct(100)) %>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
ciq_tbl

```

#### Distributions

The distribution for the total score is presented below:

```{r csi-distributions, class.source='fold', echo = FALSE}
complete %>%
  composite_hist(
    x = ciq_psych_total,
    bins = 10
    ) +
  labs(title = 'Distribution for CIQ Psychological Scale')
```


## The Drug Abuse Screening Test (DAST)

### DAST Description

<MIN/SHAINA>TODO: ROW DATA INCORRECTLY CLEANED, WILL NEED RE_CLEAN!

<SHAINA> TODO: CHECK AFTER DATA IS CLEANED

The DAST is a self-report instrument used to assess problems related to
substance use.

For the present study, 22 items from the DAST were collected and a total
score was constructed. No subscales were created for this measure as
there was a lack of evidence supporting a subscale structure.

Two items (`d4` and `d5`) should to be reverse scored which is noted in
the variable table below and the reverse scored variables are provided
(`d4_r` and `d5_r`). Higher scores indicate more problems related to
substance use.

<TODO: Maria please check if you like this sentences here> 
TC who are incarcerated while assessment was done weren't asked for this survey. 

<SHAINA> TODO: CONFIRM THIS IS CORRECT AND IF SHOULD BE APPLIED IN
TABLES BELOW - specify -77 The missing data rule was applied.
Calculations were completed only with participants that had less than
20% missing data (this includes `-77` responses)

Reference:
[\@gavin1989diagnostic](https://onlinelibrary.wiley.com/doi/abs/10.1111/j.1360-0443.1989.tb03463.x);[DOI](https://doi.org/10.1111/j.1360-0443.1989.tb03463.x)

### DAST Variables

#### Value Labels

All The Drug Abuse Screening Test variables have the same response
options.

```{r DAST-label-table, results = 'asis'}

dast_label_df <- data.frame(
  value = c(1,0),
  label = c("Yes",
            "No")) %>% 
  t() %>% 
  as.data.frame()

dast_label_df <- setNames(dast_label_df[-1, ], unlist(dast_label_df[1, ]))


#create table
dast_label_table <- dast_label_df %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  cols_width(everything() ~ px(180)) %>% 
  apply_labtab_theme()

# Print the table
print(dast_label_table)


```

<MARIA> TODO: CONFIRM THIS TABLE SHOULD BE INCLUDED AND WHAT VARIABLES
THEY APPLY TO Re-coded total value label `dast_total_r`

```{r DAST-label-table-total, results = 'asis'}
dast_label_total <- data.frame(
  value = seq(0,4),
  label = c("None",
            "Low",
            "Intermediate (likely meets DSM criteria)",
            "Substantial",
            "Severe")) %>% 
  t() %>% 
  as.data.frame()

dast_label_total <- setNames(dast_label_total[-1, ], unlist(dast_label_total[1, ]))


#create table
dast_label_table_total <- dast_label_total %>%
  gt() %>% 
  tab_options(table.border.top.width = 1, table.border.bottom.width = 1,
              table.border.left.width = 1, table.border.right.width = 1) %>% 
  #cols_width(c(1:5) ~ px(151)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_labtab_theme()

# Print the table
print(dast_label_table_total)


```

#### Survey Items

All DAST survey items are presented in the following table:

This questionnaire deals with certain drug use and social behavior patterns. Please answer each of the items truthfully by stating Yes or No to me, thinking about the past 6 months.

```{r DAST-var-prep}
# Pull question wording from qualtrics data
dast_word <- qualtrics %>% 
  select(starts_with("D")) %>% 
  rename(dast_screen = D00) %>%
  slice(1)

#create table with variable name, description, and notes
dast_word_long <- dast_word %>% 
  pivot_longer(cols = everything(), 
               names_to = "var_name",
               values_to = "description") %>% 
  mutate(description = str_replace(description, "^\\d+\\.\\s*", ""),
         var_name = str_to_lower(var_name),
         notes = case_when(var_name == "d4" ~ "This item should be reverse scored. `d4_r` is reverse scored",
                           var_name == "d5" ~ "This item should be reverse scored. `d4_r` is reverse scored",
                           TRUE ~ as.character("")
                           )
         ) %>% 
  mutate(description = if_else(var_name == "dast_screen", "Is TC currently pregnant?", description)) %>%
  slice(4:25)

```

```{r dast-var-table, results ='asis'}
# Create the gt table object and apply generic theme
dast_gt_table <- gt(dast_word_long)

# Table-specific formatting (col width, names)
dast_gt_table <- dast_gt_table %>% 
  cols_label(var_name = "Variable", 
             description = "Description",
             notes = "Notes") %>% 
  apply_tbl_theme() %>% 
  cols_width(notes ~ px(150),
             var_name ~ px(100)) %>%
  tab_options(table.width = pct(100))%>%
  tab_style(style = cell_text(align = "left"), locations = cells_column_labels())
 

# Print the table
print(dast_gt_table)

#WHEN RENDERING WITH PDF USE: 
#dast_gt_table
```

#### Scale and Subscales

Information on the total score is below. The total score was constructed
by summing all items.

```{r dast alpha, echo = FALSE, eval = TRUE, message = FALSE, warning = FALSE}
#Calculate internal reliability 
dast_alpha <-
  complete %>%
  select(d1a:d3, d6:d5_r) %>%
  mutate(d2 = coalesce(d2a, d2b)) %>% 
  select(-d2a, -d2b) %>% 
  drop_na(d2) %>% 
  psych::alpha(check.keys = TRUE)

```

<MIN> DATA CLEANING TODO: need check the total

```{r DAST-scale-table, results = 'asis'}
# Create the table as a data frame
# TODO:Maria, should we remove d00 from total? 
dast_scale_df <- data.frame(
  var_name = c("dast_total"),
  scale = c("Total Score (22)"),
  scale_construction = c("`d00`, `d1a`, `d2a`, `d2b`, `d3`, `d4_r`, `d5_r`, `d6`, `d7`, `d8`, `d9`, `d10`, `d11`, `d12`, `d13`, `d14`, `d15`, `d16`, `d17`, `d18`, `d19`, `d20`"),
  scale_range = c("0-20"),
  alpha = c(round(dast_alpha$total$raw_alpha, 3))
)

# Create the gt table object
dast_scale_table <- gt(dast_scale_df) %>%
  cols_align(columns = c("scale_range"), align = "center") %>% 
  cols_label(var_name = "Variable Name",
             scale = "Scale (# of items)", 
             scale_construction = "Scale Construction",
             scale_range = "Range*",
             alpha = "Alpha") %>% 
  tab_footnote(footnote = "*Range of possible values; `_r` Reverse scored variable") %>% 
  tab_options(table.border.bottom.style = "hidden") %>% 
  cols_width(scale ~ px(150),
             scale_construction ~ pct(50)) %>% 
  tab_options(table.width = pct(100))%>%
  apply_tbl_theme() 

# Print the table
print(dast_scale_table)

```

### Summary Statistics

#### Descriptive Statistics

Descriptive statistics are presented below for each item and the total
score.

For binary items:

```{r dast-binary-desc}
# Create subset of DAST items
dast_data_subset_binary <- complete %>%
  select(d1a:d20)

# Calculate the dichotomous summary statistics for each variable
dast_summary_data_binary <- lapply(dast_data_subset_binary, function(x) {
  per_no <- paste0(round(sum(x == 0, na.rm = TRUE) / length(x) *100, 1), "%")
  per_yes <- paste0(round(sum(x == 1, na.rm = TRUE) / length(x) *100, 1), "%")
  num_no <- sum(x == 0, na.rm = TRUE)
  num_yes <-sum(x == 1, na.rm = TRUE)
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(per_no = per_no, per_yes = per_yes, num_no = num_no, num_yes = num_yes, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
dast_summary_data_binary <- as.data.frame(dast_summary_data_binary)

# Set items as first row
dast_summary_data_binary <- rbind(names(dast_summary_data_binary), dast_summary_data_binary) %>% 
  t() %>% 
  as.data.frame()

# Create the gt table
dast_tbl_binary <- dast_summary_data_binary %>%
  gt() %>%
  cols_label(`1` = "Variable",
             num_no = "N",
             per_no = "%",
             num_yes = "N",
             per_yes = "%",
             Missing = "% Missing") %>% 
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("per_no", "per_yes", "num_no", "num_yes", "Missing"), align = "center") %>% 
  tab_spanner(label = "No", columns = c(num_no, per_no)) %>% 
  tab_spanner(label = "Yes", columns = c(num_yes, per_yes)) %>% 
  tab_style(style = list(cell_fill(color = "#9BB6D1")),
            locations = cells_column_spanners()) %>% 
  apply_tbl_theme() %>% 
  tab_style(style = list(cell_fill(color = colorspace::lighten("#9BB6D1", .4))),
            locations = cells_column_labels(columns = c(num_yes, num_no, per_yes, per_no))) 

# Render the table
dast_tbl_binary


```

For the total score:

```{r dast-cont-desc}
# Create subset of DAST items
dast_data_subset <- complete %>%
  select(dast_total)

# Calculate the dichotomous summary statistics for each variable
dast_summary_data <- lapply(dast_data_subset, function(x) {
  mean_val <- sprintf("%.2f", round(mean(x, na.rm = TRUE), 2))
  sd_val <- round(sd(x, na.rm = TRUE), 2)
  range_val <- paste(min(x, na.rm = TRUE), max(x, na.rm = TRUE), sep = "-")
  miss_val <- round(mean(is.na(x)) * 100, 2)
  c(Mean = mean_val, SD = sd_val, Range = range_val, Missing = paste(miss_val, "%", sep = ""))
})

# Convert summary_data to a data frame
dast_summary_data <- as.data.frame(dast_summary_data) 

# Set items as first row
dast_summary_data <- rbind(names(dast_summary_data),dast_summary_data) %>% 
  t() %>% 
  as.data.frame() %>%
  mutate(Mean = if_else(Mean == "NaN", "NA", Mean)) %>%
  mutate(Range = if_else(Range == "Inf--Inf", "NA", Range))

 



# Create the gt table
dast_tbl <- dast_summary_data %>%
  gt() %>%
  cols_label(`1` = "Variable",
             Range = "Range",
             Missing = "% Missing") %>% 
  cols_width(everything() ~ px(115)) %>%
  tab_options(table.width = pct(100))%>%
  cols_align(columns = c("Mean", "SD", "Range", "Missing"), align = "center") %>% 
  tab_footnote("*Range of data values") %>% 
  tab_options(table.border.bottom.style = "hidden") %>%
  apply_tbl_theme()

# Render the table
dast_tbl

```

#### Distributions

The distribution for the total score is presented below:

<#TODO: Maria, should I use reversed total score for this distributions?>
```{r}
complete %>%
  composite_hist(dast_total) +
  labs(
    title = 'DAST Total Score Distribution'
    )
```

#### Clinical Categories

The distribution for the total score alongside clinical severity
categories are presented below.

<MARIA>INSERT MORE INFO ON SEVERITY CUTOFF SCORES - what do they
categorize?, how should they be used

Reference: <SHAINA/MARIA> INSERT REFERENCE FOR DAST SCORES - MARIA, WHAT
IS REFERENCE?

```{r dast-distributions, class.source='fold', echo = FALSE}
complete %>%
  severity_plot(
  x = dast_total,
  bins = 20,
  low_xmin = 0,
  low_xmax = 5.5,
  medium_xmin = 5.5,
  medium_xmax = 10.5,
  large_xmin = 10.5,
  large_xmax = 15.5,
  critical_xmin = 15.5,
  critical_xmax = 20) +
  annotate(
    geom = 'text',
    color = 'Black',
    x = 3,
    y = -1.5,
    label = 'Low'
  ) +
  annotate(
    geom = 'text',
    color = 'Black',
    x = 8,
    y = -1.5,
    label = 'Intermediate'
  ) +
  annotate(
    geom = 'text',
    color = 'Black',
    x = 13,
    y = -1.5,
    label = 'Substantial'
  ) +
  annotate(
    geom = 'text',
    color = 'Black',
    x = 18,
    y = -1.5,
    label = 'Severe'
  ) +
  labs(
    title = 'Severity Categories',
    subtitle = 'Based on DAST',
    caption = 'Cutoffs are:\nLow = 1-5,\nIntermediate = 6-10,\nSubstantial = 11-15,\nSevere = 16-20',
    y = 'Number of Participants'
  )
```
